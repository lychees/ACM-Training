
\chapter{ACM/ICPC World Finals 2012~(12/12)}

\section{[A]Asteroid Rangers}
\subsection{题意简述}
三维坐标上~$n$~个点，每个点匀速直线运动，求最小生成树改变的次数~$+1$。

【数据范围】$n\leq 50$，$-150\leq x,y,z\leq 150$，$-100\leq v_x,v_y,v_z\leq 100$。
\subsection{算法分析}
对于每个事件点，发生大小关系改变的两条边中，定义在事件点之后长度变得更小的边为取代边，另一条为被取代边，如果被取代的边不在当前的最小生成树上，那么最小生成树显然不会发生改变，更进一步地，只有在取代边的两端点在最小生成树的路径中包含被取代边，最小生成树才会发生改变。而一条边树的路径上，相当于这条边断开后，路径两端点不连通，也就是一个在子树内，另一个不在子树内，这样就可以在每次最小生成树改变后维护~$dfs$~序，$O(1)$~就可以得到对于边是否在路径上的询问。由于每次最小生成树改变后需要重新得到~$dfs$~序，每次为~$O(n)$~，但由于答案大概不会超过~$O(n^3)$~的，所以复杂度也为~$O(n^4)$。此外，造出答案超过几百的数据很困难（至少我随机数据得到的答案大概是~$O(n^2)$~的）。

【时间复杂度】$O(n^4\log{n})$，【空间复杂度】$O(n^4)$。

\section{[B]Curvy Little Bottles}
\subsection{题意简述}
给出一个每一小段都是圆柱形的瓶子的横截面上半部分的形状对应的多项式~$P(x)=\sum_{i=0}^{n}{a_ix^i}$，以及底部和顶部~$x$~坐标~$x_{low},x_{high}$~，求瓶子的体积，并每隔~$inc$~ 单位体积标刻度线（最多只标前~$8$~条），求刻度线相对于底部的~$x$~坐标。保留两位小数，并保证刻度线之间的距离至少为~$0.05$~。

【数据范围】$n\leq 10~,~-100\leq a_i\leq 100~,~a_n\neq 0~,~-100\leq x_{low}<x_{high}\leq 100~,~x_{high}-x_{low}>0.1~,~1\leq inc \leq 500$。
\subsection{算法分析}
显然体积$=\displaystyle \int_{x_{low}}^{x_{high}}\pi P(x)^2~dx$，把平方暴力展开后计算即可。而标刻度线时要解的是~$2n$~次方程，直接解有难度，但注意到本题精度要求不高，而且保证了刻度线之间的间距，所以可以按~$0.005$~暴力枚举，一旦在当前刻度时体积超过~$j\times inc$~了，则标上第~$j$~条刻度线。

【时间复杂度】$O(\displaystyle \frac{x_{high}-x_{low}}{eps}\times n^2)$，【空间复杂度】$O(n)$。

\section{[C]Bus Tour}
\subsection{题意简述}
$n$~个点~$m$~条边的图中，~$0$~号点是起点，~$n-1$~号点是终点，要从起点遍历其他所有点，然后到达终点，并从终点遍历其他点回到起点，遍历过程中可以中途经过某些点但不算作到达。要求第一次遍历的前~$\left\lfloor\frac{n-2}{2}\right\rfloor$~个点在第二次遍历中也是前~$\left\lfloor\frac{n-2}{2}\right\rfloor$~个，求总路程最短是多少。

【数据范围】$n\leq 20$。
\subsection{算法分析}
这个问题和~$TSP$~问题很像，而~$TSP$~问题可以用~$O(2^n\times n^2)$~的复杂度解决。所以使用类似的方法解决此题。先~$floyd$~预处理，那么就可以得到两两之间实际的最短距离了（中转点只算途径）。用~$f[i][j]$~ 表示从起点出发，遍历过的点的二进制状态为~$i$~，当前在~$j$~号点，最小的路程和为多少，转移时只需枚举一个还未经过的点作为下一个点即可。同样地~$g[i][j]$~表示从终点出发的情况。最后，枚举一个大小为~$\left\lfloor\frac{n-2}{2}\right\rfloor$~的子集作为先经过的部分，剩余部分为后经过的部分，分别枚举两部分最后到达的点，找出两次遍历的最小值，相加取~$\min$~即可。

【时间复杂度】$O(2^n\times n^2)$，【空间复杂度】$O(2^{n-1}\times n)$。

\section{[D]Fibonacci Words}
\subsection{题意简述}
~$F(n)$~为~$string$，定义~$F(n) = \displaystyle \begin{cases}0 & if~n = 0 \cr 1 & if~n = 1 \cr F (n - 1) + F (n - 2) & if~n \geq 2 \cr \end{cases}$

其中~$+$~表示字符串的连接。给出~$n$~和模式串~$p$，问~$p$~在~$f(n)$~中出现了几次。

【数据范围】$n\leq 100~,~\left|p\right|\leq 10^6$~,~答案~$<2^{63}$~。
\subsection{算法分析}
出现次数可递推~$f(n)=f(n-1)+f(n-2)+extra(n)$~，其中~$extra(n)$~表示~$F(n-1)$~和~$F(n-2)$~连接后新增的~$p$~的出现次数。而涉及到新增部分的长度不会超过~$2\left|p\right|$~，所以在预处理时保留~$F(n)$~的前~$10^6$~位和后~$10^6$~位即可，然后在计算~$extra(n)$~时把涉及到的串拼接出来后用~$KMP$~算法求~$p$~在其中出现的次数即可。

【时间复杂度】$O(n\times \left|p\right|)$，【空间复杂度】$O(n\times \left|p\right|)$。

\section{[E]Infiltration}
\subsection{题意简述}
~$n$~个点的图，两两之间有且仅有一条有向边。选出这个图的一个大小最小的点集，使所有点都能从点集中某个点经过最多一条边到达。

【数据范围】$n\leq 75$。
\subsection{算法分析}
由于两两都有边，所以对于当前未覆盖的点集，肯定可以选出一个点使未覆盖点集大小减少一半。因此使用贪心算法构造出的解答案最多$\log_2{n}$。在此基础上，已经确定答案不大，所以使用搜索，枚举所有可能的选择方式，并加入最优性剪枝，使用~$bitset$~优化是否覆盖所有点的判断后即可通过数据。

【时间复杂度】$O(\sum_{i=1}^{\log_{2}{n}}\binom{n}{i}\times \frac{n}{32})$，【空间复杂度】$O(\frac{n^2}{32})$。

\section{[F]Keys}
\subsection{题意简述}
有~$n$~个钥匙（分为两类）和~$m$~个钥匙环，给出初始的钥匙与环、环与环的连接状态，保证环与环的连接不会构成环。求最少的钥匙滑进滑出环的次数把两类钥匙分类（不同类钥匙不能在同一个钥匙环的块中），在这前提下最小化环滑进滑出的次数。

【数据范围】$n,m\leq 26$。
\subsection{算法分析}
钥匙要尽量少地移动，而只有在一个钥匙环上有两种钥匙时才需要移动，所以直接枚举每个钥匙环上留下的钥匙。但可能会出现所有环上都保留了某一种钥匙的情况，这时要腾出一个环给另一种，则枚举那个环，把它改为保留另一种。所有情况取最优值。

然后求最少的环操作，问题变为森林中若干点必须为1，若干点必须为2，还有一些点无要求，断开一些边，使所有不同类的钥匙分离，最后要把同类钥匙都连起来。这相当于要最小化断开的边数，树形DP，~$f[i][j]$~表示第~$i$~个点为根的子树中，当前保留的是第~$j$~类钥匙，断开的最少边数。

【时间复杂度】$O(2^\frac{n}{2}\times n^2)$，【空间复杂度】$O(n)$。

\section{[G]Minimum Cost Flow}
\subsection{题意简述}
三维空间内~$n$~个点，每个点上有~$c_i$~个洞，可以把洞作为连接口和其他点连接，费用为两点间的欧几里德距离，否则如果水到达了这个点，就必须把洞全部堵上，费用为每个洞~$0.5$。现在要从~$1$~号点向~$n$~号点运水，可以控制水平面高度，求最小费用。

【数据范围】~$n\leq 400~,~m\leq 50000$~。
\subsection{算法分析}
枚举水平面的高度，则高度~$\leq$~水平面的点构成了多个连通块。新建水管可以看作选一条从~$1$~号点所在连通块到~$n$~号点所在连通块的路径，要求路径上除了起始块和结束块之外的每个连通块都要有两个至少两个洞，而起始块和结束块也要有至少一个洞，费用为$($路径上所有连通块的洞的个数之和-新建水管数$\times 2)\times 0.5$。而找这样的路径相当于单源最短路问题，用并查集合并连通块后使用spfa或dijkstra算法即可。

【时间复杂度】$O(n\times spfa(V=n,E=n^2))$，【空间复杂度】$O(n+m)$

\section{[H]Room Service}
\subsection{题意简述}
从凸~$n$~边形内一点出发，碰到所有边至少一次后回到该点，求最短距离。碰到端点视为两条边都碰到。

【数据范围】$n\leq 100$。
\subsection{算法分析}
首先考虑这样一个问题，从点~$A$~出发，碰到直线~$L$~上任意一点后，到达点~$B$~，求最短路径。做法是把点~$A$~沿直线做镜面反射，~$A'$~与~$B$~的距离就是最短距离，连线就是方案。如果有两条直线，那就反射两次。但当~$L$~为线段时，交点不能取到，这时肯定是某个端点最优。

回到本题，有个比较显然的结论，最优方案中路径是不会相交的，一定是按照某个顺序依次经过每条边。又因为路径是可逆的，所以我们可以假设是按顺时针顺序。

而由开始的结论，只有端点的状态有效，先预处理端点两两之间的距离~$d[i][j]$~，即把出发点沿中途经过边依次反射，最后得到的点和到达点构成的直线是最优路径。但该路径只有和每条反射的边都有交时才合法，所以不断倒着反射回去，看每条边是否和路径都相交。然后使用~$floyd$~得到两点间最短路。

然后先枚举起始边，计算起点直接回到起点的方案，并预处理起点出发到每个点的距离~$Ds[]$~和每个点出发到终点的距离~$Dt[]$~，然后枚举起点出发到达的点~$j$~和出发到达终点的点~$k$~（~$j$~和~$k$~可以相等），用~$Ds[j]+d[j][k]+Dt[k]$~更新答案。

【时间复杂度】$O(n^3)$，【空间复杂度】$O(n^2)$。

\section{[I]A Safe Bet}
\subsection{题意简述}
底面为$R\times C$的盒子中有~$m$~面垂直放置，水平呈`/'状~$45^\circ$放置的镜子和~$n$~面呈`$\backslash$'状~$45^\circ$放置的镜子，从~$(1,0)$~向右发射一条光线，若光线遇到镜子会发生$90^\circ$ 反射，若最后光线从~$(R,C)$~向右射出，则可以打开盒子。判断当前情况是否直接打开箱子，若不能，求出放置一面镜子使其打开的方案数（同一格两种放置方式只算一种），并输出字典序最小的一个答案。

【数据范围】$n,m\leq 10^5~,~R,C\leq 10^6$。
\subsection{算法分析}
先模拟光线的运动，记录发射位置和方向，每次在当前方向上找下一面镜子（用~$set$~优化），然后修改位置和方向，继续模拟。如果光线从~$(R,C)$~向右射出，则打开。否则从~$(R,C+1)$~向左射出光线，反向追踪。可以发现可行位置为两次追踪得到的轨迹的交点个数。那么在两次追踪过程中分别记录下横向和纵向轨迹，然后第一次的横向和第二次的纵向求交，第二次横向和第一次纵向求交，求交过程可以用扫描线，并用线段树或树状数组优化单点修改，区间询问。求出交点个数和字典序最小的交点即可。

【时间复杂度】$O((n+m)\log C)$，【空间复杂度】$O(n+m+C)$。

\section{[J]Shortest Flight Path}
\subsection{题意简述}
地球表面有~$n$~个机场，要求从机场~$s$~飞到机场~$t$~，且始终满足：离最近机场的距离不超过~$R$~。由于油箱限制，最大连续飞行距离为~$c$~。

本题距离都是指球面距离（假定飞机沿着地球表面飞行）。假设地球是半径为~$6370km$~的球，有~$Q$~组询问~$(s,t,c)$~。

【数据范围】$n\leq 25,Q\leq 100$。
\subsection{算法分析}
两个保护圈的交点是关键点，先两两求交求出所有关键点。

把机场和关键点当作节点，然后判断所有节点之间的路径是否合法，即判断大圆圆弧是否被所有保护圈的并所覆盖（对每个保护圈求出在大圆上对应的圆弧，转为区间覆盖问题）。

然后~$floyd$~求出机场两两之间的最短路。对于每个询问，根据~$c$~重新判断每对机场是否可以直达。然后再做一遍~$floyd$~后可得到最短距离。

下面考虑保护圈求交。~$R$~是圆面距离，可以转为弧度，再转为空间距离，同时利用经纬度可以求出所有机场坐标和新的圆心坐标。

由于所有圆半径相等，则交点肯定位于与两圆圆心连线垂直的大圆面上。两圆心连线中点为该平面上另一点，利用这些可得到该平面法向量。

然后转化为一个圆和大圆求交，而这也是区间覆盖时需要使用的。

将小圆投影到大圆面上，设小圆圆心到大圆面的距离为~$D$~，则两个交点到投影后的圆心的距离变为~$\sqrt{R^2-D^2}$~，利用该等式可重新建立一个在大圆面上的圆，然后变成了同一平面上的两圆求交。

先求出该平面上的~$x,y$~单位向量，然后套用平面几何的方法，余弦定理求出两圆心和某一交点组成的三角形中角~$O$~的大小，然后可得到两交点坐标。

而在圆弧覆盖时，需要确定一个~$0$~弧度的位置，然后求出其他弧度，可把起点设为~$0$~弧度，利用法向量可以求出~$x,y$~单位向量，其他求交时得到的圆心需要转换为相对弧度，即表示成~$(Ax+By)$~的形式（注意有三个方程，但有两个是等价的，需要判断出来），然后用~$atan2$~求弧度。

在~$LiveArchive$~上需要~long double~才能过。

最后还有一个要注意的是，两点在两极，则三点共线，无法求法向量。如果是两圆求交，那么求交无意义（交点不是关键点或没有交点），直接退出。如果是在判断路径是否合法时，只有~$R$~可直接覆盖全球时能直接判为可行，否则，我代码中直接判成不可行了（可能数据中没有这种情况）。但似乎不能直接判为不可行，可行路径不一定可以被表示为经过若干中转点得到的路径，所以需要把所有关键点所在大圆都判一遍。

【时间复杂度】$O(n^6+Qn^3)$，【空间复杂度】$O(n^2)$。

\section{[K]Stacking Plates}
\subsection{题意简述}
$n$~个长为~$m_i$~的非递减序列合并为一个非递减序列，求最少的一分为二~或~合二为一次数。

【数据范围】$n,m_i\leq 50$。
\subsection{算法分析}
如果没有相同元素，则排序后相邻元素来自不同序列的数量即为所需的合并次数。现考虑相同元素，则用~$DP$~来最小化合并次数，用~$f[i][j]$~表示高度~$\leq i$~的，最后一个元素来自序列~$j$~的最小合并次数，转移时对于当前高度，由于来自相同序列的元素肯定连续最优，所以分别枚举第一个和最后一个元素来自的序列并转移。使用滚动数组更加方便。

【时间复杂度】$O(n^2m)$，【空间复杂度】$O(n\times m)$。

\section{[L]Takeover Wars}
\subsection{题意简述}
$A$~和~$B$~各有一个数字集合（大小分别为~$n,m$），两人轮流操作，A先手，每次操作方可以合并自己集合中两个数（值相加），或用己方集合中的一个值删去对方集合中的一个值（要求己方的值大于对方的值）。若某方集合为空则判输。

【数据范围】$n,m\leq 10^5$。
\subsection{算法分析}
首先发现两人都要让最大值越大越好，所以合并肯定是优先合并最大值和次大值，而删对方的值一定是用最大值去删除对方尽可能大的值。

所以如果你这一步能得到最大值比对方下一步能得到的最大值大，那么就选择合并，因为这一步如果删去对方的值，还不如下一步删。

否则如果能删去对方最大值则删去，因为如果对方删我的，对方的损失肯定比我的大，所以对方一定会合并，如果对方合并后最大值没超过我，显然比我合并后被对方超过好；如果对方合并后最大值会超过我，则说明即使我这一步合并也会被超过，所以还不如删去对方最大值。

如果我不能删去对方最大值，我删其他值损失肯定比对方大，所以只能选择合并。

把读入数排序后按这个策略选择下去即可。

【时间复杂度】$O(n\log n+m\log m)$，【空间复杂度】$O(n+m)$。

