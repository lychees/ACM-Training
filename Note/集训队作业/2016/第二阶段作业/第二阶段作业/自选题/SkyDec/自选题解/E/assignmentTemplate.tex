\documentclass{noiassignment}

\begin{document}

%% 解题报告开始

\title{Permutant解题报告}
\author{绍兴市第一中学洪华敦}

\maketitle

\section{试题来源}
$Topcoder~SRM684~Hard$
\section{试题大意}
给定一个正整数数组$a[1..n]$，设$m=\sum_{i=1}^{n}a[i]$

设$b[1..n]$为$a[1..n]$的一个随机排列

设$s[j]=\sum_{i=1}^{j}b[i]$

求$\frac{m!}{\prod_{i=2}^{n}s[i]}$的期望值

你需要返回答案乘$n!$后对$1000000007$取模的值

$1\leq n\leq 50$，$1\leq a[i]\leq 50$，$1\leq m\leq 1000$
\section{算法介绍}
\subsection{弱化版题目}
这道题是十分难的，我们可以先考虑他的弱化版

注意到我们要求的是$\frac{m!}{\prod_{i=2}^{n}s[i]}$

我们考虑弱化版：求$\frac{m!}{\prod_{i=1}^{n}s[i]}$

相当于是：一开始你的值有$m!$，和为$m$，每次值除掉和，和减去最后一个$s$的值

我们大胆地猜测，这个和是$\frac{m!}{\prod_{i=1}^{n}a[i]}$
\subsubsection{证明一}
我们可以用数学归纳法证明

当$n=1$时，显然是成立的

假设这个公式对于$n-1$时是成立的，现在证明他对于$n$时是成立的

考虑枚举最后一个数是哪个，假设是$j$，则答案为剩下$n-1$个数自由排列后的答案除$m$

根据数学归纳法，答案是：

$$\sum_{j=1}^{n}\frac{m!}{m\prod_{i\neq j}a[i]}$$

$$\frac{1}{m}\sum_{j=1}^{n}\frac{m!}{\prod_{i\neq j}a[i]}$$

$$\frac{1}{m}\sum_{j=1}^{n}\frac{m!*a[j]}{\prod_{i=1}^{n}a[i]}$$

$$\frac{1}{m}\frac{m!*m}{\prod_{i=1}^{n}a[i]}$$

$$\frac{m!}{\prod_{i=1}^{n}a[i]}$$

证毕

然而这种证明方法很难推广到原题的解法
\subsubsection{证明二}
考虑一种直观证明：

有$m$颗球，每个球有颜色，第$i$种颜色的有$a_i$个，每个球有互不相同的编号。现在考虑这些球的排列是有$m!$种的

我们相当于随机了一种颜色的排列，答案是$\frac{m!}{\prod_{i=1}^{n}s[i]}$

我们可以理解为，先考虑$m$个球，要求第一棵球是颜色$n$的标号最小的球，然后把颜色$n$的球全部拿掉，对剩下$m-a[n]$个球和$n-1$个颜色继续做

这样最后的结果就是：每种颜色第一个出现的球标号一定是这个颜色里最小的

于是答案就是$\frac{m!}{\prod_{i=1}^{n}a[i]}$
\subsection{推广}
现在考虑原题目，根据弱化版的证明二，我们发现答案就相当于最后一个出现的颜色标号是可以随便排的

我们可以考虑动态规划，算出一种颜色在最后的排列数是几个

令$f[i][j][k]$表示前$i$个颜色，最后出现的颜色是$j$，$j$的第一个球的位置后面剩余的空位数量是$k$

转移时，考虑颜色$i+1$放在哪里，如果他不放在最后的话，枚举他有几个在后$k$个，几个在前$m-k$个即可

如果他要放最后的话，则在$k$个空位里选出放第一个球的位置即可

于是最后直接枚举一遍统计答案就好了

时间复杂度$O(n^3m)$，常数相当小，可以通过此题
\end{document}




