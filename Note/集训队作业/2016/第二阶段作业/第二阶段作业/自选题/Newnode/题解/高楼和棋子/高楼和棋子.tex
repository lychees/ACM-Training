\documentclass{noiassignment}

\usepackage[colorlinks, citecolor = green, linkcolor = blue, menucolor = red, CJKbookmarks=true]{hyperref}

\begin{document}

%% 解题报告开始

\title{高楼和棋子~解题报告}
\author{安徽师范大学附属中学~~吴作凡}

\maketitle

\section{试题来源}

51nod的320分题，链接：\url{https://www.51nod.com/onlineJudge/questionCode.html#!problemId=1306}

\section{试题大意}

有一个$n$层的高楼和$m$个棋子，存在一个$E(0\leq E\leq n)$使得棋子从$E$楼或以下扔不会碎，超过$E$楼扔下就会碎。

现在给出$n$和$m$，问最坏情况下最少需要实验多少次才能计算出准确的$E$（如果棋子摔碎了，就不能继续用这个棋子进行测试了）。

数据范围：数据组数$T\leq 50000,n\leq 10^{18},m\leq 64$。

\section{算法介绍}

如果棋子数量是无限多的，最好的方法显然是直接二分，$O(\log n)$次就可以求出$E$，所以数据范围中才会有$m\leq 64$。

\subsection{算法一}

这个题目显然可以dp，最暴力的方法就是令$f_{i,j}$表示$i$层楼$j$个棋子最坏情况至少要多少次实验，那么转移就枚举当前扔哪层楼就好了$$f_{i,j}=1+\min_{k=1}^{i}\{\max (f_{k-1,j},f_{i-k,j-1} )\}$$
这样dp的复杂度是$O(n^2m)$，显然不能通过本题。

如果我们把$f$数组输出，很容易发现当$j$和$k$确定的时候，满足$f_{i,j}=k$的$i$是一个连续的区间，而且这也是一个很显然的结论――有$j$个棋子，如果$k$次实验能找出$n$层楼，肯定也能找出$n-1$层楼。于是我们可以换一种方式进行dp，设$g_{j,k}$表示有$j$个棋子，$k$次实验最多能找出多少层楼。

考虑如何转移，我们第一次随便在某层楼实验一下，如果棋子碎了我们就需要在这层楼以下实验，那么还剩$j-1$个棋子和$k-1$次实验，所以这层楼以下最多还有$g_{j-1,k-1}$层楼。类似的，如果棋子没碎就要在这层楼以上实验，还剩$j$个棋子和$k-1$次实验，所以最多有$g_{j,k-1}$层楼。于是有$$g_{j,k}=1+g_{j-1,k-1}+g_{j,k-1}$$

$g$的转移方式类似组合数，所以增长速度还是相当快的，可以发现当$m=3$的时候最多只有几百万，之后会越来越小，于是$m\geq 3$的可以预处理dp数组，用二分求解答案。

观察式子可以发现有$$g_{1,k}=k$$
$$g_{2,k}=\frac{k(k+1)}{2}$$
于是可以特判掉$m=1$或2的情况。

因为要二分，所以时间复杂度$O(T\log n)$。

\subsection{算法二}

题目中说的最坏情况就是要求我们的方法能够区分出所有$E$（$E$的意义同题意），同样我们可以考虑使用$j$枚棋子和$k$次实验最多能区分多少个$E$。

我们首先将我们的决策构造成一棵树，这是一棵二叉树，每个节点都表示一次实验，如果碎了就向左孩子走，没碎就向右孩子走。

显然最后的每个叶子都会表示一个不同的$E$，于是就是统计叶子节点数。而$k$次实验要求我们的树深度不能超过$k$，只有$j$枚棋子要求我们从根到任意一个叶子只能经过至多$j$次向左孩子走的边。

如果给每个叶子一个$k$位编号表示根到它的路径，第$i$位为1就表示向左走，为0就是向右走，显然叶子和编号是一一对应的，我们只需要关心编号数就好了。

有$j$个1的编号显然有$\binom{k}{j}$种，因为最多有$k$个1，那么能区分的$E$的个数就是$$\sum_{j=0}^{k}\binom{k}{j}$$
因为$0\leq E\leq n$，所以$n$的最大值就是$g_{j,k}=\sum_{j=1}^{k}\binom{k}{j}$，可以用数学归纳法证明这个式子满足算法一的dp方程。

于是我们就可以二分答案然后用这个公式快速计算$g_{m,k}$了，直接二分的复杂度是$O(Tm\log n)$的，这个复杂度不如算法一优秀。

我们发现这个式子是一个关于$k$的$m$次多项式，而且最高次项的系数为1，那么答案是$O(n^{\frac{1}{m}})$级别的，用这个来限制二分的范围，复杂度就是$O(Tm\log{n^{\frac{1}{m}}})=O(T\log n)$。
%% 解题报告结束

\end{document}
