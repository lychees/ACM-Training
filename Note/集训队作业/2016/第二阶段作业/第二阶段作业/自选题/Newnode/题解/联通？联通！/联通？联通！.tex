\documentclass{noiassignment}

\usepackage[colorlinks, citecolor = green, linkcolor = blue, menucolor = red, CJKbookmarks=true]{hyperref}

\begin{document}

%% 解题报告开始

\title{联通？联通！~解题报告}
\author{安徽师范大学附属中学~~吴作凡}

\maketitle

\section{试题来源}

51nod~算法马拉松10的E题，链接：\url{https://www.51nod.com/onlineJudge/questionCode.html#!problemId=1620}

\section{试题大意}

有$n$个点在$x$轴上，坐标为$(i,0)(1\leq i\leq n)$。$x$轴上方有$n1$个点，$x$轴下方有$n2$个点。其中$x$轴和$x$轴上方这$n+n1$个点形成了树,下方也同样形成了树。$x$轴上的点之间互相没有边，$x$轴上方的点和$x$轴下方的点之间也没有边。

现在随机从$n1$个点和$n2$个点中各选择$1$个点记为$(Pa,Pb)$，删掉纵坐标$\geq Y_{Pa}$的所有点和$\leq Y_{Pb}$的所有点，求剩下的图联通的概率。

保证图是平面图。

数据范围：$n,n1,n2\leq 10^5$。

\section{算法介绍}

\subsection{算法一}

我们把在$x$轴上方的点称为$A$部分，下方称为$B$部分，$x$轴称为$C$部分，那么图中的边只有$AC$/$BC$/$AA$/$BB$四种，图联通的充要条件就是
\begin{itemize}
\item 只保留$AA$/$AC$部分的边后，每个$A$中的点都和$C$中的至少一个点联通。
\item 只保留$BB$/$BC$部分的边后，每个$B$中的点都和$C$中的至少一个点联通。
\item $C$中的点$(i,0)$和$(i+1,0)$联通。
\end{itemize}

判定第一个条件非常容易，不需要考虑$B$中的点，按照纵坐标从小向大扫描，用并查集维护图联通性，只要记录每个联通块是否存在$C$中的点就好了。于是我们可以预处理哪些$Pa$点是合法的。第二个条件同理，可以预处理哪些$Pb$点是合法的。

考虑如何维护第三个条件，如果我们枚举$Pa$，那么一定存在一个$MaxPb$使得纵坐标小于等于它的点都合法，其余都不合法。如果我们能求出这个$MaxPb$，我们就可以用前缀和查询有多少满足第二个条件的$Pb$，计算有多少组合法的$(Pa,Pb)$，然后计算概率。

我们考虑$C$中两个点仅靠$A$部分而联通的时候纵坐标至少是多少（也就是这两个点的路径中纵坐标的最大值），假设$(i,0)$和$(i+1,0)$的路径中纵坐标最大是$Ymax$，那么对于任意的$a\leq i,i+1\leq b$，$(a,0)$到$(b,0)$的最大值都不会小于$Ymax$，否则如下图路径将会相交而不满足平面图和树的性质：
\begin{center}
  % Requires \usepackage{graphicx}
  \includegraphics[width=5cm]{wzf_.png}\\
\end{center}

于是我们考虑$(i,0)$和$(i+1,0)$时不需要管$C$中的其他点，可以预处理在$A$部分需要的纵坐标和$B$中的纵坐标（可以用树上倍增求$Lca$来完成），然后按纵坐标从大向小枚举$Pa$，每次都会断开一些$(i,0)$和$(i+1,0)$，它们需要在$B$部分中联通，那么我们更新当前的$MaxPb$就好了。

时间复杂度$O(n\log n)$，如果用tarjan求$Lca$可以将复杂度降为$O(n\alpha(n))$。

\subsection{算法二}

在上一个问题中，我们利用了树和平面图的性质，那么如果现在不保证是树和平面图，仅仅告诉你图中的边只有$AC$/$BC$/$AA$/$BB$四种（当然边数$m$不会很多，比如$m\leq 3\times10^5$），该如何处理呢？

还是分三个条件考虑，前两个条件做法并没有用到树和平面图的性质，依然可以那样处理，于是只需要考虑第三个条件怎么做。

我们按纵坐标从大向小枚举$Pa$，显然$MaxPb$的纵坐标是递减的，也就是说$A$部分中的边会不断减少而$B$部分边将会增加，这是一个经典的动态图联通性问题！

一般的动态图问题我们都可以用LCT维护一棵最小生成树来解决。对于这道题，一条边的权值就是连接的两个点的纵坐标的较大值，我们加边的时候用LCT维护最小生成树，如果删边的时候这条边还在最小生成树上，就多了一个联通块，需要从$B$中加边来使其联通（当然如果一个联通块不存在$C$中的点我们就不需要管它了），于是用一个指针扫描$MaxPb$ 就好了。

时间复杂度$O(m\log n)$，参考程序\verb|connect.cpp|就是该算法。

%% 解题报告结束

\end{document}
