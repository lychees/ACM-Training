\documentclass{noiassignment}

\begin{document}

%% 解题报告开始

\title{Fairy 解题报告}
\author{东营市胜利第一中学~~姜志豪}

\maketitle

\section{试题来源}

Codeforces Beta Round \#19

提交：http://codeforces.com/problemset/problem/19/E

\section{试题大意}

给出一张~$n$~个点，~$m$~条边的无向图。现在要删除一条边，使这张图变成一个二分图。

求所有方案。

~$1\leq n\leq 10^4, 0\leq m\leq 10^4$~

\section{算法介绍}

\subsection{问题分析}

一个图是二分图，当它没有奇环。

构造一个原图的生成森林，并对森林中的点黑白染色，使森林中有边直接相连的点颜色不同。

可以将边分为两类，在森林中的边是树边，不在森林中的边是非树边。

非树边可以分为两类，若边连接了两个相同颜色的点，我们称之为奇环边，否则称之为偶环边。

若不存在奇环边，那么这个图就是一个二分图，删去任何一条边后仍然是二分图。下面只考虑有奇环边的情况。

一条非树边~$E$~删除后图能够变成二分图，当且仅当~$E$~是奇环边，并且没有其他奇环边。

一条树边~$E$~删除后图能够变成二分图，那么~$E$~必须被所有奇环边覆盖。树边~$A$~被非树边~$B$~覆盖是指，若~$B$~的两个端点是~$c$~和~$d$~，那么在森林中，~$A$~在~$c$~到~$d$~的路径上。仅仅满足这个条件还不够，还要求~$E$~不被任何偶环边覆盖。因为如果~$E$~既被奇环边覆盖，又被偶环边覆盖，那么奇环和偶环叠加后，会得到一个不包含~$E$~的奇环（如下图）。

\includegraphics[width=60mm]{1.png}

图中紫色实边表示将要删除的边~$E$~，蓝色实边表示其他树边，红色虚边是一条奇环边，蓝色虚边是一条偶环边。虽然~$E$~被唯一的奇环边覆盖了，但由于它也被偶环边覆盖了，在删除~$E$~后，图中仍然存在一个奇环。

\subsection{具体实现}

非树边删除后，剩余图是否是二分图，这比较容易判断。只需求出哪些非树边是奇环边就可以了。

判断树边删除后剩余图是否是二分图，需要求出这条边是否被所有奇环边覆盖、是否被任一偶环边覆盖。我们可以直接求一条边被多少条奇环边覆盖、被多少条偶环边覆盖。

枚举每一条非树边，它覆盖的边是一条路径，更新这条路径上所有边的信息。

构造生成森林时，可以按照dfs树的构造方式进行构造。这样，非树边都是连接了一个点和这个点的某一个祖先结点。那么非树边覆盖的路径，就是从一个点出发，一直向祖先方向延伸的路径。在树上进行差分，枚举到一条非树边时，就只需要修改两个点的信息。最后进行一次前缀和，得到每条树边被奇环边、偶环边覆盖的次数，进而求出问题的解。

时间复杂度：~$O(n+m)$~

%% 解题报告结束

\end{document}
