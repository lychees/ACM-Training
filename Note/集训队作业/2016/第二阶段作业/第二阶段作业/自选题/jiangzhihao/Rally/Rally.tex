\documentclass{noiassignment}

\begin{document}

%% 解题报告开始

\title{Rally 解题报告}
\author{东营市胜利第一中学~~姜志豪}

\maketitle

\section{试题来源}

POI 2014

bzoj提交：http://www.lydsy.com/JudgeOnline/problem.php?id=3832

\section{试题大意}

给出一张有~$n$~个点~$m$~条边的有向无环图，每条边的长度都是1。

找出一个点，使得删掉这个点后剩余的图中的最长路径最短。

输出删除的点、删除这个点后图中的最长路径长度。

多解时输出任意一组。

$2\leq n\leq 5\times 10^5, 1\leq m\leq 10^6$

\section{算法介绍}

\subsection{算法一}

先考虑如何求图中的最长路径长度。

可以先对图进行拓扑排序，求出点~$i$~在拓扑序中的位置~$p_i$~。按拓扑序进行dp，求以点~$i$~为终点的最长路径长度~$f_i$~。

也可以按拓扑序的逆序进行dp，求出以点~$i$~为起点的最长路径长度~$g_i$~。

枚举删除的点，每次都dp一遍求出最长路径长度。

时间复杂度：~$O(nm)$~

\subsection{算法二}

删除点~$x$~时，对于一条剩余图上的长度为~$L$~的路径，一定是前~$k(0\leq k\leq L)$~个点的拓扑序比~$x$~小，后~$L-k$~个点的拓扑序比~$x$~大。可以将剩余图上的路径分为两类：

1.路径上所有点的拓扑序都比~$x$~大或小。

2.路径上存在一条边，连接了一个拓扑序比~$x$~小的点和一个拓扑序比~$x$~大的点。

按拓扑序枚举删除的点~$x$~，用权值线段树对这两类路径进行维护。具体过程如下：

\begin{kai}

最初，把所有点~$i$~的~$g_i$~加入线段树中。

当枚举到~$x$~时，依次进行：

1.将~$g_x$~从线段树中删除。

2.枚举所有终点为~$x$~的边~$E$~，将包含~$E$~的最长路径长度从线段树中删除。若~$E$~的起点为~$a$~终点为~$b$~，那么包含它的最长路径长度为~$f_a+g_b+1$~。

3.现在线段树中的最大值就是不经过点~$x$~的最长路径长度。求出这个值，更新答案。

4.将~$f_x$~加入线段树。

5.枚举所有起点为~$x$~的边~$E$~，将包含~$E$~的最长路径长度加入线段树。

\end{kai}

时间复杂度：~$O(m\cdot log\ n)$~

%% 解题报告结束

\end{document}
