\documentclass{noiassignment}

\begin{document}

%% 解题报告开始

\title{Mirror Room 解题报告}
\author{东营市胜利第一中学~~姜志豪}

\maketitle

\section{试题来源}

Codeforces Round \#168 (Div. 1)

提交：http://codeforces.com/problemset/problem/274/E

\section{试题大意}

假设有一个~$n\times m$~的网格。左上角的格子坐标是~$(1,1)$~，右下角的格子坐标是~$(n,m)$~。网格中有~$k$~个堵塞的格子，其他的格子是空的。你在空格子~$(x_s,y_s)$~的中心向一个对角线方向（也就是东北，西北，东南，西南）发射一束激光。如果光束碰到堵塞的格子或网格边界，它会反射。在不同情况下光束的反射方式如下图所示。

\includegraphics[height=30mm]{1.png}

过了一会儿，光束进入了一个无限的循环。计算至少被光束通过一次的空格子数。我们认为光束通过了一个格子的中心才算是通过了这个格子。

~$1\leq n,m\leq 10^5, 0\leq k\leq 10^5$~

\section{算法介绍}

光线只有遇上边界或堵塞的格子才会改变方向，所以改变方向的位置是有限的，光线的方向又最多只有四种，所以光线在循环之前改变方向的次数是~$O(n+m+k)$~级别的。我们可以模拟光线的移动。已知光线位置和光线的方向，使用二分的方法可以在~$O(log\ k)$~的时间复杂度内求出即将改变方向的位置和改变后的方向。

我们暂把光线的位置和方向称为光线的状态。一种状态只能转移到一种状态。如果从状态~$a$~能转移到状态~$b$~，那么~$b$~反向后的状态能转移到~$a$~ 反向后的状态。所以一种状态也只能从一种状态转移而来。这就像是一种置换，所以从初始状态出发，必定会回到初始状态，并且回到初始状态之前不会重复经过某种状态。

我们对网格进行染色，有邻边的格子颜色不同，形成一个二分图。根据光线反射的方式，可以发现，当光线沿西北、东南方向前进时，只会经过一种颜色的格子。当光线沿东北、西南方向前进时，只会经过另一种颜色的格子。所以光线在某一个格子中心时，要么只会是西北、东南方向之一，要么只会是东北、西南方向之一。

这样，如果一次循环内一个格子被重复经过，只有可能是光线以相反的两个方向进入，并且一次循环内一个格子最多被经过两次。一个格子被经过两次，所有被光线经过的格子都会被经过两次。如果光线在前进过程中出现过下图中的两种反射，所有格子就会被经过两次。只需在模拟的过程中记录是否出现过这两种情况即可。

\includegraphics[height=28mm]{2.png}

时间复杂度：~$O(\ (n+m+k)\cdot log\ k\ )$~

%% 解题报告结束

\end{document}
