\documentclass{noiassignment}

\begin{document}

%% 解题报告开始

\title{Allergy Testing 解题报告}
\author{东营市胜利第一中学~~姜志豪}

\maketitle

\section{试题来源}

Google Code Jam World Finals 2014

提交：https://code.google.com/codejam/contest/7214486/dashboard\#s=p4

\section{试题大意}

Kelly对~$n$~种食物中的一种过敏，但她不确定是哪一种。所以她想通过一些实验来确定。

每次实验，Kelly可以选取几种不同的食物然后全吃了，~$A$~天之后，她就可以知道是否有过敏反应，如果没有，就说明她对吃的那几种食物都不过敏。如果她有过敏反应，她就需要等过敏反应褪去，这个过程从刚开始吃算起需要~$B$~天。

任何一个实验必须等上一个实验完成（等~$A$~天或者~$B$~天）后开始，每次实验开始时，她可以根据前面的实验结果来选择这次要吃的食物集合。

求在最坏情况下，Kelly最少要多少天可以找到那个过敏食物。

~$1\leq n\leq 10^{15}, 1\leq A\leq B\leq 10^{12}$~

\section{算法介绍}

定义~$f_i$~，表示用~$i$~天时间最多在~$f_i$~种食物中找出过敏食物。

这~$i$~天刚开始时，Kelly选出一些食物吃，若过敏，则要在剩下的~$i-B$~天中从吃了的食物中找出过敏食物，所以最多选~$f_{i-B}$~种吃；若不过敏，则要在剩下的~$i-A$~天中从没吃食物中找出过敏食物，所以没吃的食物最多有~$f_{i-A}$~种。

所以，~$f_i=f_{i-A}+f_{i-B}$~。

若只吃了一种，即使过敏，也只需~$A$~天即可找到过敏食物，但在方程中却是需要~$B$~天。所以，我们使边界条件是：

~$f_i=1(\ A-B\leq i\leq 0\ )$~

通过DP的过程，我们可以对应建一棵树。~$i$~对应的树，根结点值为~$f_i$~，左子树是~$i-A$~对应的树，右子树是~$i-B$~对应的树。对于满足~$A-B\leq i\leq 0$~的~$i$~，~$i$~对应的树只有一个点，值为1。

\includegraphics[width=100mm]{1.png}

我们发现，~$f_i$~的值即为~$i$~对应树中叶结点的个数。

在树~$i$~中，叶结点~$t\ (A-B\leq t\leq 0)$~的个数就是：~$i$~每次可以减~$A$~，也可以减~$B$~，减到~$t$~的方案数。

每次对半分，最坏情况下需要~$B\cdot log\ n$~天。可以在0和~$B\cdot log\ n$~之间二分，找到满足~$f_i\geq n$~的最小~$i$~，这个最小~$i$~即为答案。

下面考虑计算~$f_i$~的值。因为当前二分到的~$i$~不超过~$B\cdot log\ n$~，所以可以枚举~$i$~减到~$t$~的过程中减了几次~$B$~，进而确定减~$A$~的次数范围，使~$i$~减去这么多~$A$~、~$B$~后在~$[A-B, 0]$~内。确定了减~$A$~、减~$B$~的次数，用组合数就能求出方案数。

对于每一个枚举到的减~$B$~的次数~$s$~，若对应的减~$A$~的次数范围为~$[x, y]$~，则对答案的贡献是：

~$C_{s+x}^{s}+C_{s+x+1}^{s}+...+C_{s+y}^{s}$~

从杨辉三角上可知，上式等于：

~$C_{s+y+1}^{s+1}-C_{s+x}^{s+1}$~

每一个~$s$~计算出的值之和就是~$f_i$~。

有了求~$f_i$~的方法后，就可以二分求出问题的答案了。

时间复杂度：~$O(log^4 n)$~

%% 解题报告结束

\end{document}
