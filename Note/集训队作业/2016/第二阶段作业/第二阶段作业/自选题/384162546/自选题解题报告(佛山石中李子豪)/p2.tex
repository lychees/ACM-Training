\documentclass{noiassignment}

\begin{document}

%% 解题报告开始

\title{《circuit》解题报告}
\author{佛山石中 李子豪}

\maketitle

\section{试题来源}

    CTSC 2012

    可在BZOJ2805找到。

\section{试题大意}

    给定一棵$N$个节点组成的边上带电阻的树，叶子全部接地，形成一个电阻网络。
    
    $M$次操作，操作分为两种：
    
    1.在某条边上加一个电源；
    
    2.查询某个点的对地电压。
    
    $N,M \leq 5*10^4 , $树中最长链长度$L$不超过$50 $

\section{算法介绍}

\subsection{基本物理模型的分析}
    这道题，比较容易受到各种奇奇怪怪的电阻、电源的影响，从而难以正常思考题目。因此，我们先从最简单的弄起。
    
    首先，是电阻的问题。电阻的连接分为串联与并联两种。
    
    串联：$R={\sum_{i}}R_{i} $.
    
    并联: $\frac{1}{R}={\sum_{i}} \frac{1}{R_{i}} $
    
    通过这两种电阻基本连接，我们就可以把一个电阻网络用一个总电阻来代替，从而简化问题。
    
    然后，是电压的问题。我们同样只需要知道串并联的分压原理以及电压差的问题即可。
    
    串联：
    
    \quad    $\frac {U_{i}}{R_{i}} =C,C$为一定值。
    
    \quad    ${\sum_{i}}U_{i} = U,U$为总电压。
    
    
    并联：
    
    \quad    ${U_{i}}=U,U$为总电压。
    
    然后，电压差的问题，我们假设每个节点有一个电压$U_{i}$,那么$ab$节点间的电压差$U_{ab}=U_{a}-U_{b}$.
    
    最后，是电源的问题。这个问题，我们容易发现，各个电源之间实际上是相互独立的，我们可以独立考虑每一个电源对各节点的电压的贡献即可。
    


\subsection{暴力算法}

    每插入一个电源，我们可以以电源所在位置为起点，然后通过串并联的分压原理求出各节点的电压值，并累加到该节点的最终电压值中。
    
    对于询问操作，我们则可以查询当前节点的电压值。
    
    这个方法复杂度为$O(nm)$.

\subsection{优化算法}
    
    对于上一个算法，我们可以发现问题在于每一次更新都把所有点更新一遍，速度非常慢。而询问则只需要询问一个点，速度比较快。
    
    因此，我们可以通过一些改变，使得更新不需要更新所有点，询问也不只询问一个点，从而使总体复杂度更优。
    
    假如我们知道根节点的电压值，那么我们可以很简单的求出其余各点的电压值：
    $U_{k}={\prod_{i}}\frac{sum_{i}}{R_{i}+sum_{i}}U_{root} $,i在root到k的路径上，$R_{i}$为i与父亲连边的电阻，$sum_{i}$为i子树的总电阻。
    
    那么，我们把这个根节点的电压值看作标记flag，进一步的就可以得到任意节点的电压值：
    $U_{k}={\sum_{j}} {\prod_{i}}\frac{sum_{i}}{R_{i}+sum_{i}}flag_{root} $ ,$j$是$k$或$k$的祖先，i在$k$到$j$的路径上
    
    因此，我们就可以解决这一问题了。

    

\section{时空复杂度}
    空间复杂度$O(N)$,时间复杂度$O(N+ML)$.

\section{总结}
    通过对物理模型的转换，转换为基本的树上询问问题，然后考虑解决方法。
    

%% 解题报告结束

\end{document}
