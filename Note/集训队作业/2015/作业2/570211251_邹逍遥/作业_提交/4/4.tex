\documentclass{noiassignment}

\begin{document}

%% 解题报告开始

\title{Rectangle Query解题报告}
\author{宁波市镇海中学~~邹逍遥}

\maketitle

\section{试题来源}
Codechef September Challenge 2014

http://www.codechef.com/SEPT14/problems/QRECT
\section{试题大意}
要求维护一个结构支持以下三种操作：

\begin{itemize}
\item 插入一个矩形$(x1,y1)-(x2,y2)$。
\item 删除某个以前插入的矩形。
\item 给出一个矩形$(x1,y1)-(x2,y2)$询问有多少个矩形和这个矩形有交点。（不一定要有边相交，有一部分相交就行，所以包含在内部也算相交）
\end{itemize}

一共有$m$个操作。
\section{数据范围}
$1\leq m\leq 10^5$

$1\leq x1,x2,y1,y2\leq 10^9$
\section{算法介绍}
\subsection{算法一}
相交矩形数量=矩形内部的左下角或右上角点数-完全在询问矩形内部的矩形个数+完全包围询问矩形的矩形个数

假如可以统计出后两个信息，那么就可以通过数矩形内部的点来轻松回答询问。不过这两个信息都比较难以统计。
\subsection{算法二}
相交矩形数量=四条边与其他矩形的边的相交数量/2+完全在询问矩形内部的矩形个数+完全包围询问矩形的矩形个数

同理，需要统计后两种信息，无法处理。
\subsection{算法三}
那么考虑正难则反，统计所有不相交的矩形数量。即一左一右分离的情况。

由于这几种情况都是两个矩形完全分离，那么就比较容易统计。以左右分离为例：

在加入矩形的时候增加一条矩形右边界，在查询的时候查询当前区间左边界以左有多少个当前存在的右边界。

这个询问可以使用树状数组比较容易地完成，或是任何一个支持单点+1/-1修改前缀查询的数据结构。

但是注意到这样会产生一些重复情况，比如说有一个矩形既在它上方也在它右边。所以需要减掉这些情况。

那么处理的情况类似，每次插入时就将这个矩形的右上角那个点加入，查询时需要统计所有在左下角那个点的左下方的点的数量。

而这是一个经典的二维数点问题，可以使用二维线段树解决。但是题目并没有要求强制在线，所以可以使用排序+扫描线+树状数组解决。

时间复杂度$O(m\log^2 m)$。

%% 解题报告结束

\end{document}
