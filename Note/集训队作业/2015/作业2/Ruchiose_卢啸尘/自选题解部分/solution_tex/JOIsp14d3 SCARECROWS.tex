\documentclass{noiassignment}

\begin{document}

%% 解题报告开始

\title{SCARECROWS 解题报告}
\author{宁波镇海蛟川书院~~卢啸尘}

\maketitle

\section{试题来源}

IOI2014日本队选拔赛(第三试): かかし

\section{试题大意}

平面直角坐标系上有$N$个点。

有多少个矩形符合：内部没有点，左下角和右上角都是点。

$N \le 200000$，不同点的坐标中同名分量值互异。由于可以离散化所以可以认为X和Y都是是1到$N$的排列。

\section{算法介绍一}

这是一个分治算法。

首先按X坐标分治。

问题转化为求左下角在左点集，右上角在右点集中的方案数。

可以为每个左点集中的点计算出一个右上点的最高Y坐标，满足右上角在这个高度时，构成矩形在分治轴的左侧部分中间没有点。为右点集也可以相应地计算左下点最低Y坐标。

我们考虑左点集中点A。它的最高容许Y是$Y^\prime_A$，它的Y是$Y_A$，类似定义右点集中的B的$Y_B$和$Y^\prime_B$属性。

则它们能构成合法矩形的条件是：$Y^\prime_B \le Y_A \le Y_B \le Y^\prime_A$。

将$Y_A$和$Y^\prime_B$拿去排序，把每个$Y^\prime_B$当成位置在$Y_B$的一次插入，把每个$Y_A$当做对区间$[Y_A, Y^\prime_A]$的区间查询，使用树状数组解决之。

分治带来一个log，树状数组带来一个log，复杂度是$O(N log^2 N)$。

\section{算法介绍二}

这也是一个分治算法。

首先按X坐标分治。

问题转化为求左下角在左点集，右上角在右点集中的方案数。

然后按Y坐标分治。

问题转化为求左下角在左下点集，右上角在右上点集中的方案数。

显然这些点集中只需要留最靠近分治两轴交点的那一圈点（具体的说，使得不存在该点集中的另一个点，它在两个分量上都更接近分治两轴交点），接下来称之为半壳。

考虑我们在左下半壳枚举了左下点。由于左上点集和右下点集的制约，左下点对应的右上半壳中的可行右上点是右上半壳的一个区间。用二分来求出这个区间。

这样的复杂度带有三个log，两个来自分治，一个来自二分。

然而，随着左下点在左下壳上移动，右上点可行区间也会相应的移动，并且移动是单向的。使用two pointer类似技术可以去掉二分的那个log。

最后的复杂度是$O(N log^2 N)$。

%% 解题报告结束

\end{document}
