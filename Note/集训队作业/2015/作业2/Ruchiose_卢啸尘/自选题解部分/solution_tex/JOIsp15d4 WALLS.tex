\documentclass{noiassignment}

\begin{document}

%% 解题报告开始

\title{WALLS 解题报告}
\author{宁波镇海蛟川书院~~卢啸尘}

\maketitle

\section{试题来源}

IOI2015日本队选拔赛(第四试): 防壁

\section{试题大意}

给出一个长为$M$的整数序列。

有$N$个询问：有一个长度为$L_i$的可以移动的区间，最初在范围$[A_i, A_i + L_i]$。现在对序列中的$M$个数进行依次处理，每次处理的时候都可以平移区间，使得正在处理的数被该区间包含。问处理这$M$个数的过程中中此区间至少移动多少距离。

$N, M \le 200000$。

\section{算法介绍}

\subsection{朴素的想法}

每次贪心向目标方向移动即可。也就是说如果要处理的数在目前区间内，不动；在区间外，则以原来靠的比较近的那端贴到目标位置。复杂度$O(NM)$。

\subsection{一个观察}

如果序列中存在连续递增或递减的三个数，那么删去中间的那个数不影响答案。

现在这个序列变成了一个波浪形序列。每一个值都是极小/极大值。

\subsection{感受一下模拟过程}

我们把极大值称为右峰，极小值称为左峰，将一个端点和同名的峰在相同位置的区间称为贴在某个峰的内侧，将一个端点与异名的峰在相同位置的区间称为贴在峰的外侧。

在移动过程中，处理一开始的（被包含在此区间中的）几个数时，区间是不动的。之后它贴到一个峰上（以内侧或是外侧），并且如果这一步贴在峰的外侧，下一步就是贴在峰的内侧。

如果这个区间的长度足够小的话在这之后这个区间将一直贴在当前峰的内侧。

\subsection{但如果不足够小呢？}

考虑右峰P和接下来的左峰Q。$|PQ| \le L_i$。那么区间将留在$[P - L_i, P]$的位置，直到遇到第一个位置小于$P - L_i$的左峰或大于$P$的右峰。然后它将贴到那个峰的内侧。

这个动作将类似于左峰Q不存在的情况。

\subsection{多组询问和这个性质？}

将所有询问按$L_i$升序排序。则当发现$|PQ| \le L_i$的时候就可以将峰Q抹去了。

使用一个单调队列维护各相邻峰之间的水平距离，在某两个峰水平距离中的的最小值$|PQ|$小于当前$L_i$的时候就需要在波形中删去一些点。

\subsubsection{PQ在波形中部}

称P前的峰为峰O，Q后的峰为峰R。

由于$|PQ|$是$|OP|, |PQ|, |QR|$中最小的，O和R都在PQ外侧。则从O到R的情况类似于P和Q不存在的情况。

删去峰P，峰Q。新的O和R仍然是峰。

\subsubsection{PQ在波形头}

这种情况下的操作是删去峰P。其正确性证明如下。

称Q后的峰为峰R。约定P是一个左峰，则有$R \le P < Q$。

当区间最初在P以左时，区间在处理P的时候是向右的，这步之后区间贴在P的外侧，在处理Q的时候是要移动直到贴在Q的内侧，也是向右移动的。因此删去P不影响结果。

当区间包含P时，自然删去P没有影响。

当区间最初在P之右时，区间在处理P时向左移动到到达$[P, P + L_i]$，它是包含Q的，因此处理Q时不动，到了处理R时又是向左移动。而删去P时也是只有一次或两次左移（视$A_i$与$Q$关系而定）。起点和目标都一样，并且没走过回头路，所以删去P前后也不影响结果。

\subsubsection{PQ在波形末}

这种情况下和在波形中部一样删去Q。但是P就不用删去了。

\subsubsection{波形中只有一条PQ}

这时就不应该做任何操作了。因为到达P的时候是有可能贴在外侧的，而非内侧。这就是说，波形中只有一条线段时，就不再修改波形。

\subsection{算法流程}

1. 将序列波形化。

2. 将询问排序。

3. 逐个处理询问。同时修改波形，维护波形折线长信息。计算询问的答案时，前两步移动暴力模拟（由于第一条线段的长度大于区间长度，分类讨论可以证明暴力模拟到第二步时区间已经贴在峰内侧了），之后的步骤直接利用维护的波形折线长信息算出。
%% 解题报告结束

\end{document}
