\documentclass{noiassignment}

\begin{document}

%% 解题报告开始

\title{KANJI SHIRITORI 解题报告}
\author{宁波镇海蛟川书院~~卢啸尘}

\maketitle

\section{试题来源}

IOI2014日本队选拔赛(第四试): h字しりとり（汉字接龙）

\section{试题大意}

这是一道非传统题。你需要编写两个程序，Anna和Bruno。

程序Anna将得到一张带权有向图$G = (V, E)$，和$Q$个询问，分别是求$S_i$到$T_i$的最短路径是哪条。程序Bruno也将得到这些信息，但是Bruno得到的信息中，存在一个点，这个点的出边中的$P$条的边权丢失了。Anna将得到具体是哪些边的边权丢失了。程序Anna 可以给程序Bruno发送若干个比特。程序Bruno将根据程序Anna的信息来回答这$Q$个询问。

$|V| \le 300, W_i < 2^{54}, Q \le 60, P \le 5$。

\section{得分判定}

本题由若干个子任务构成：

\subsection{子任务1. 10分}

$Q \le 10$，最短路使用不超过10条边。

发送比特数限制为1000个。

\subsection{子任务2. 22分}

发送比特数限制为180个。

\subsection{子任务3. 8分}

发送比特数限制为160个。

\subsection{子任务4. 40分}

发送比特数限制为90个。

\subsection{子任务5. 20分}

为了得到这个子任务的分数，你最多只能发送84个比特。发送的比特数越小分数越高。

当你发送的比特数达到64个或更少时得到本子任务的满分。

\section{显而易见的40分算法}

所有不知道边权的边，其出发点相同。

也就是说一旦走过了其中的某一条边，就没有必要走其他的边。

Anna对每个询问，计算：不通过这$P$条边的方案，和分别通过这$P$条边中之一的方案中，哪个更加优。

共60个询问，方案数是$P+1 = 6$种。直接发送的话就是每个询问3个比特，总180个比特，得到32分。

将每三个询问合成一组，共20组，每组有$216$种方案，用8个比特发送它，总160个比特，得到40分。

\section{80分算法}

这里有6种方案，它们之间构成了15对关系。在Bruno看来，为了知道两个方案之间孰者更优，他需要知道，一条边的长度是否超过某一常数，或两条边的长度是否超过某一常数。

这15对关系的60个询问中的常数是不同的。从而Bruno可以将它们排序。此时如果Anna告诉Bruno，在某一对关系的60个询问中，有多少个询问的答案是true，那么Bruno就可以具体地还原出这900个询问的答案，从而得到每个最短路询问应当使用哪一方案。

每对关系需要6个比特，总90个比特，得到80分。

即使压常数也压不到84个比特，所以不能得到更多的分数。

\section{100分算法}

如果我们发送了太多的比特，这就是说，通过发送更少的信息，我们依然能达到目标。

我们考察现在Bruno知道些什么。

Bruno知道对于每一个询问，它的15对关系的具体值。

实际上，Bruno可以对每一个询问的全6种方案作出排序。

然而题目只要求最短路径。

那么就不需要排序了，问题变成求最小值。

求最小值的方法是，一开始将第一个东西作为最小值，将后面的东西一个一个拿过来，和当前最小值相比。

这个算法就是这样。

最初60个询问都以方案1为其最优方案，然后Anna告诉Bruno：“有$i$个你现在认为最优方案是方案1的询问，方案2比方案1更优”。显然Bruno可以计算出Anna说的是哪些询问。

从而Anna需要发送15个整数。其中第一个数的最大值是$Q$，第二个和第三个数的最大值的和是$Q$，以此类推。

从而在最坏情况下：

第一轮，Anna发送代表0到61中某一整数的6个比特；

第二轮，Anna发送代表0到$31^2$中某一整数的10个比特；

第三轮，Anna发送代表0到$21^3$中某一整数的14个比特；

第四轮，Anna发送代表0到$16^4$中某一整数的16个比特；

第五轮，Anna发送代表0到$13^5$中某一整数的19个比特。

总65个比特，得到98分。

然而我们还可以做的更好――将五轮合成一个整数发送，就只需要64个比特，得到100分。由于只需要64个比特，直接用unsigned long long就可以处理了。



%% 解题报告结束

\end{document}
