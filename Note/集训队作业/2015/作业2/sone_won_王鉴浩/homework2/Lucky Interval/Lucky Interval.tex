\documentclass{noiassignment}

\setlength{\parskip}{0.5\baselineskip}
\usepackage[colorlinks, citecolor = green, linkcolor = blue, menucolor = red, CJKbookmarks=true]{hyperref}


\begin{document}

%% 解题报告开始

\title{Lucky Interval 解题报告}
\author{绍兴市第一中学~~王鉴浩}

\maketitle

\section{试题来源}

\href{http://codeforces.com/contest/109/problem/E}{CF~109E}

\section{试题大意}

4~和~7~这两个数叫幸运数字。
定义一个函数：$F(x)$~表示为~$x$~在十进制下按位分解，有多少位是幸运数字。

现在有一个区间~$[a,a+l-1]$，我们需要找到一个最小的~$b~(a<b)$，并使得~$F(a)=F(b),F(a+1)=F(b+1),...,F(a+l-1)=F(b+l-1)$。

数据范围：$1\le a,l\le 10^9$

时限：$4s$

\section{算法介绍}

考虑简单的暴力，可以先把~$F(x)$~预处理出来，然后做~$kmp$~寻找最小的~$b$。
计算~$F(x)$~我们可以通过把数切成两半并经过预处理后，在时间复杂度为~$O(1)$~内计算。
但是，这样的解法是无法通过此题的。

解决此题，需要来分析幸运数字的特殊性质。

考虑每个数的个位，数字~$0,1,2,...,9$~对~$F(x)$~的贡献分别是：
$$0,0,0,0,1,0,0,1,0,0$$

那么可以得到一个显然的结论：
\begin{enumerate}
  \item 当~$10\le l$~的时候，$(b-a)\%10=0$。
  \item 当~$100\le l$~的时候，$(b-a)\%100=0$。
  \item 当~$1000\le l$~的时候，$(b-a)\%1000=0$。
  \item $...............$
\end{enumerate}

对于第一条结论，我们可以简单地理解为：当~$10\le l$~时，有且只有一个个位当起点，才能保证这~$l$~个数的个位对~$F(x)$~贡献一致。
其他结论理解同理。而且我们可以发现，当幸运数字为~0~和~5~时，这些结论就不成立了。

于是，我们就可以对暴力进行优化：
我们可以每隔~$10^{\left\lfloor \log_{10} l \right\rfloor}$~个选一个数作为关键点，然后做~$kmp$~寻找最小的~$b$。
但是，当~$l$~比较小的时候，我们的优化就没有意义了。

我们需要换一个角度来解决此题。设~$b=f(a,l)$。
根据上述结论，可以得到一个上限解：
$$10~f\left(\frac{a}{10},\frac{a+l-1}{10}-\frac{a}{10}+1\right)+(a \bmod 10)$$

再根据结论，可以发现当~$10\le l$~时，这个上限解就为最优解；当~$1\le l<10$~我们进行特判。
于是，最多只需要做两次特判就可以计算出~$b$~了。

对于特判，我们需要继续考虑幸运数字的特殊性：
\begin{itemize}
  \item 我们设~$g(a)=p$，满足~$F(p)=F(a),a<p$~并最小化~$p$。
  \item 当~$l=1$~的时候，$f(a,l)=g(a)$。
  \item 对于计算~$g(a)$，可以发现当~$a$~的个位是~$4,7,9$~时，可以在时间复杂度为~$O(\log_{10} a)$~计算~$g(a)$，其他情况可以~$O(1)$~计算。
\end{itemize}

对于特判，我们需要暴力枚举合法的~$q$，满足~$a<q,F(a)=F(q)$~且~$q$~不超过我们的上限。
对于每个~$q$~，我们暴力枚举在时间复杂度为~$O(l)$~内判断。
对于暴力枚举合法的~$q$，我们可以通过~$g(a)$~函数进行快速计算。

那么，对于这个特判的解法。可以构造出一个极限数据：$a=399999997,l=9$。
对于这个数据，我们先计算出其上限为~500000004。
所以，我们暴力枚举合法的~$q$~是需要枚举~$8^8$~个数的。
由于这个枚举把所有除了第一位外都不是幸运数字的数都枚举了一遍，所以枚举是时间复杂度为：$O(8^8)$。
又由于在~$O(l)$~判断时第二次就出错中断枚举了。

所以上述解法的时间复杂度为~$O(8^8)$。

%% 解题报告结束

\end{document}
