\documentclass{noiassignment}

\begin{document}

\title{Museum 解题报告}
\author{长郡中学~~陈胤伯}

\maketitle

\section{试题来源}

http://main.edu.pl/en/archive/pa/2014/muz

\section{试题大意}

你打算潜入一个博物馆盗窃里面的展览品。

博物馆内一共有~$n$~件展览品和~$m$~个警卫。

\includegraphics{sample.png}

第~$i$~件展览品坐标~$(ax_i,ay_i)$，价值~$av_i$。

第~$i$~个警卫坐标~$(bx_i,by_i)$，你可以花~$bv_i$~的价格收买他，让他放弃安保工作。

每个警卫都面朝~$Y$~轴负方向，左右视角都为~$\theta$。如果某个展览品被某个你未收买的警卫监视着，那你将无法盗取该展览品。

问你该如何收买警卫，使得总收益（盗取的总价值$-$收买的总支出）最大。

$1\leq n,m\leq 200000$，$-10^9\leq $~坐标范围~$\leq 10^9$。

\section{算法介绍}

\subsection{最小割建模}

我们先用最小割建模。即把所有的展览品价值全部加进答案，考虑最小化失去的收益。

建立源汇~$S,T$，每个警卫建一个点~$b_i$，每个展览品建一个点~$a_i$。

$S$~向~$b_i$~连~$bv_i$~的边，割掉该边表示收买这个警卫。

$a_i$~向~$T$~连~$av_i$~的边，割掉该边表示放弃这个展览品。

如果警卫~$i$~能监视到展览品~$j$，就从~$b_i$~向~$a_j$~连一条~$+\infty$~的边，表示要么收买警卫~$i$，要么得放弃展览品~$j$。

由于最小割等于最大流，我们可以把题面转化成另一个模型：警卫~$i$~存了~$bv_i$~的水，展览品~$i$~可以容纳~$av_i$~的水，每个警卫可以把水喷到自己视野范围内的展览品里，最大化喷的总水量。

方便起见，我们不妨把坐标系“左右拉伸一下”，使得每个警卫的视角成为一个直角，然后旋转坐标系45度，变成这个样子：

\includegraphics[width = 0.5 \textwidth]{change.png}

我们把这个问题“决策化”一下，即把所有警卫和物品按~$x$~从大到小依次加入，然后决策每个警卫该如何喷水。于是有如下几种事件：

\begin{enumerate}
    \item 来了一个有~$bv_i$~水的警卫，可以喷给~$Y$~坐标不超过~$by_i$~的所有展览品水。
    \item 加入一个~$Y$~坐标为~$ay_i$~的容量为~$av_i$~的新展览品。
\end{enumerate}

我们需要决策的是情况1该如何喷水。由于每个警卫是能喷给~$Y$~不超过某个值的展览品，这意味着~$Y$~坐标越小的展览品越有机会得到浇灌，所以一个贪心的做法是，当来了一个警卫时，他从自己能喷到的展览品里按~$Y$~从大到小依次喷满，直到自己没水了或者展览品都满了。

要实现这个贪心，只需要扫描时用以~$Y$~为关键字的平衡树维护当前所有展览品，来了警卫就找到他能喷到的~$Y$~最大的展览品然后一个个喷下去。每次插入展览品~$O(\log n)$；每次警卫喷水，要么水喷光了结束喷水，要么被喷的展览品水满了于是被从平衡树中删除。因此总时间复杂度~$O(n\log n + m\log n)$。

回到原问题，用展览品价值和减去“最大喷水量”即为答案。

\end{document}
