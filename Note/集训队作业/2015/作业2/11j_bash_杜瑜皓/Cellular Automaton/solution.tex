\documentclass{noiassignment}
\usepackage[bookmarks=false, colorlinks, linkcolor=red, anchorcolor=red, citecolor=red, urlcolor=red]{hyperref}

\begin{document}

\title{Cellular Automaton 解题报告}
\author{浙江省镇海中学~~杜瑜皓}

\maketitle

\section{试题来源}

Open Cup 2014-15 Grand Prix of Japan Problem E\footnote{据我所知这套题没有公布在网络上} by rng\_58

\section{试题大意}

令$w$是一个正整数，$p$是一个长为$2^{2w+1}$的$01$串，那么$(w,p)$细胞自动机有如下的定义：

所有的细胞在一个无限长的一维空间上。每个细胞有两种状态$0$或$1$。在时间$0$，可以选择有限个格子，将其的状态设为$1$，其他都为$0$。

令$f(t,x)$表示细胞$x$在时间$t(t>0)$的状态，那么$f(t,x)$由$f(t-1,x-w),\cdots,f(t-1,x+w)$决定，$f(t,x)=p[\sum_{i=-w}^w 2^{w+i}f(t-1,x+i)]$。

一个好的细胞自动机被定义为无论怎么设置初始状态，状态中$1$的个数都一直不会变。

给定$w$和$s$，求字典序最小的字符串$p$，其中$s\leq p$，并且$(w,p)$细胞自动机是好的细胞自动机。

规定$1\leq w\leq 3$。

\section{算法介绍}

首先当$w=2$时，总共有$2^{32}$种不同的$p$串，所以可以枚举然后随机初始状态检测，并且打表。因为可行方案并不多，只有$428$种。

同时可以考虑一些剪枝，比如自动机状态为$5$位一循环的串，假设为$10101$，那么对那个循环内的串有$p_{10101}+p_{01011}+p_{10110}+p_{01101}+p_{11010}=3$，这样状态量就能减少很多。可以很快搜出来。

但对于$w=3$的情况是不可行的，因为可行的答案实在太多。

首先考虑如何判断一个自动机是好的。不妨考虑$w=2$，即$5$位的怎么判断，$w=3$同理。容易发现对于每个状态$1$的个数一直都不变等价于所有状态经过一次变换后$1$的个数不变。构造一个$2^5$个结点的图。记$S$表示当前串末$5$位为$S$的状态，考虑后面接上$1$或者接上$0$，转移到$(S*2+0)\bmod 32$和$(S*2+1)\bmod 32$这两个状态。那么新的串中会增加$p_S$个1。如果转移到$(S*2+0)\bmod 32$，那么原串中减少$0$个$1$，否则减少$1$个$1$。

考虑一个状态，因为$1$的个数有限，就是一个点从$0$号点开始，然后使用一个计数器，随着转移加上对应的点权和边权，最后回到$0$号点。其中$1$的变化次数为最后计数器的值。

为了方便，将每个点拆点，$S$向$S'$连一条$p_S$的边，然后$S'$向$(S*2+0)\bmod 32$和$(S*2+1)\bmod 32$分别连权值为$0$和$1$的边。

这样问题就转化成为了从$0$号点回到$0$号点任意一条路径上的边权和为$0$。

这就等价于每个点有个编号，并且满足$d_v=d_u+w_{u,v}$。这样只要遍历这个图，判断编号是否满足条件即可。

接下来就要解决字典序最小的问题，考虑dfs算法，只要判断一个前缀确定的情况下是否有一个可行的方案。

在这个图中，如果$p_S$确定，那么有$d_{S'}=d_S+p_S$，否则有$0\leq d_{S'}-d_S\leq 1$。

所以可以使用差分约束解决，解一定是整数。

时间复杂度$O((2^{2w+1})^3)$。

\section{总结}

这是一个很难的题，从细胞自动机转化到一个有限自动机变成图论问题，再使用差分约束解决。

尤其是最后一步，看上去是个很简单的差分约束，但是在经过前面的大量思考后，往往这一步会被忽略。

当时在比赛中只有两个队伍做出了这个题，中国和俄罗斯各一个。我在比赛中花了很长的时间，最后还是解决了这个题。

%% 解题报告结束

\end{document}
